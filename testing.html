<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Testing Package &#8212; gobash  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command Line Flags" href="command-line-flags.html" />
    <link rel="prev" title="Interactive Mode" href="interactive-mode.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="testing-package">
<h1>Testing Package<a class="headerlink" href="#testing-package" title="Link to this heading">¶</a></h1>
<p>Testing package provides features similar to xUnit frameworks
available in other languages (<cite>testing</cite> package in Go, <cite>pyunit</cite> for
Python, <cite>JUnit</cite> for Java, etc.).</p>
<section id="writing-tests">
<h2>Writing Tests<a class="headerlink" href="#writing-tests" title="Link to this heading">¶</a></h2>
<p>It is great having tests for each function. We keep test files in the
same package as the corresponding source files. Test files have to
have suffix <code class="docutils literal notranslate"><span class="pre">_test.sh</span></code>. Although not required, it is expected that
for every file, e.g., <code class="docutils literal notranslate"><span class="pre">matrix.sh</span></code>, there would be a corresponding
test file, e.g., <code class="docutils literal notranslate"><span class="pre">matrix_test.sh</span></code>.</p>
<p>Each test is a function that starts with <code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">test_</span></code>.  These
functions have to be at the beginning of lines.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_strings_cap<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1"># Valid test signature.</span>

<span class="w">  </span><span class="k">function</span><span class="w"> </span>test_strings_cap<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature (not at the beginning of a line).</span>

<span class="k">function</span><span class="w"> </span>strings_cap_test<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature (does not start with test).</span>

test_strings_cap<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature (no function keyword).</span>

<span class="k">function</span><span class="w"> </span>test_strings_cap<span class="o">()</span><span class="w">    </span><span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature (spaces after ()).</span>

<span class="k">function</span><span class="w"> </span>test_strings_cap<span class="w">   </span><span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature (spaces after the identifier).</span>

<span class="k">function</span><span class="w"> </span>test_strings_cap<span class="o">()</span>
<span class="o">{</span><span class="w"> </span><span class="c1"># NOT a valid test signature ({ not on the same line).</span>
</pre></div>
</div>
<p>Test function names in the gobash repository are formed with the
following convention:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">function</span> <span class="pre">test_</span></code> at the beginning (required)</p></li>
<li><p>name of the module being tested (e.g., <code class="docutils literal notranslate"><span class="pre">strings</span></code>)</p></li>
<li><p>name of the function being tested OR meaningful description if more than a single function is targeted</p></li>
</ul>
<p>Below are some examples from this repo.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#strings_test.sh - test for strings.sh module.</span>
<span class="k">function</span><span class="w"> </span>test_strings_len<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>...
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># complex_test.sh - test for complex.sh module.</span>
<span class="k">function</span><span class="w"> </span>test_complex_plus<span class="o">()</span><span class="w"> </span><span class="o">{</span><span class="w"> </span>...
</pre></div>
</div>
</section>
<section id="test-outcome">
<h2>Test Outcome<a class="headerlink" href="#test-outcome" title="Link to this heading">¶</a></h2>
<p>The outcome of a test corresponds to the return code from the test
function.</p>
<p>Here is an example of a trivial passing test.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_passing<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Here is an example of a trivial failing test.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_failing<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="c1"># or any other non-zero value</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="accessing-test-metadata">
<h2>Accessing Test Metadata<a class="headerlink" href="#accessing-test-metadata" title="Link to this heading">¶</a></h2>
<p>The first (and only) argument passed to each test function (test for
short) is an object (an instance of the <code class="docutils literal notranslate"><span class="pre">TestT</span></code> struct), which
carries metadata about the test itself and can be used by the
developers to set test status (more on this in later sections).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_first_arg<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>-r<span class="w"> </span><span class="nv">t</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span><span class="c1"># You can access info about the test via t.</span>
<span class="o">}</span>
</pre></div>
</div>
</section>
<section id="skipping-tests">
<h2>Skipping Tests<a class="headerlink" href="#skipping-tests" title="Link to this heading">¶</a></h2>
<p>Using a test metadata object, one can skip a test by invoking the
<code class="docutils literal notranslate"><span class="pre">skip</span></code> method. An optional message can be given as well, which will
be shown during test result reporting.</p>
<p>In the example below, we show a test that is skipped in case
dependencies for the library being tested are not
available. Specifically, when testing the <code class="docutils literal notranslate"><span class="pre">whiptail</span></code> package, we
check that dependencies for that package are available (by invoking
<code class="docutils literal notranslate"><span class="pre">whiptail_enabled</span></code>). If dependencies are not available, we skip the
test.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_whiptail_msg_box<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>-r<span class="w"> </span><span class="nv">t</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span>!<span class="w"> </span>whiptail_enabled<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">$t</span><span class="w"> </span>skip<span class="w"> </span><span class="s2">&quot;No deps.&quot;</span>

<span class="w">        </span><span class="nb">local</span><span class="w"> </span>box
<span class="w">        </span><span class="c1"># ...</span>
<span class="o">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a test fails and the skip flag is set to true, the test will be
counted as failing (and not as skipped).</p>
</div>
</section>
<section id="asserting-results">
<h2>Asserting Results<a class="headerlink" href="#asserting-results" title="Link to this heading">¶</a></h2>
<p>gobash includes a number of assertion functions (<a class="reference external" href="https://github.com/EngineeringSoftware/gobash/blob/main/src/lang/assert.sh">assert.sh</a>)
that can be conveniently used in tests. If an assertion fails, a stack
trace is printed, and <code class="docutils literal notranslate"><span class="pre">exit</span> <span class="pre">1</span></code> is executed. (Note that a failing
assertion stops only the current test, and not the entire test run,
because each test is run in a subshell.) In the library itself, we do
not use <code class="docutils literal notranslate"><span class="pre">assert</span></code> functions to ensure compatibility with <code class="docutils literal notranslate"><span class="pre">set</span> <span class="pre">-e</span></code>
option in bash.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
.<span class="w"> </span>gobash/gobash

<span class="k">function</span><span class="w"> </span>test_with_assertion<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span>assert_eq<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s2">&quot;3 and 5 are not equal&quot;</span>
<span class="o">}</span>
<span class="c1"># Output</span>
<span class="c1"># ERROR: &lt;3&gt; not equal to &lt;5&gt; (3 and 5 are not equal)</span>
<span class="c1"># 67 assert_eq $HOME/projects/gobash/src/lang/assert.sh</span>
<span class="c1"># 6 test_with_assertion ./demo_test.sh</span>
<span class="c1">#   ./demo_test.sh 708[ms]</span>
<span class="c1"># Tests run: 1, failed: 1, skipped: 0.</span>
<span class="c1"># Total time: 834[ms]</span>
</pre></div>
</div>
</section>
<section id="mocking-functions">
<h2>Mocking Functions<a class="headerlink" href="#mocking-functions" title="Link to this heading">¶</a></h2>
<p>Mocking in gobash is done on a function level. There is nothing
specific to gobash, as we simply rely on bash dynamic nature and
ability to replace any function (in a specific scope).</p>
<p>Below is an example of mocking that we use during testing of the
<code class="docutils literal notranslate"><span class="pre">whiptail</span></code> API. To avoid opening any window during testing (and
invoking <code class="docutils literal notranslate"><span class="pre">whiptail</span></code>), we implement a mock function that will be
invoked from <code class="docutils literal notranslate"><span class="pre">show</span></code>. The mock function simply returns a result that
we desire.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>test_whiptail_input_box<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>-r<span class="w"> </span><span class="nv">t</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">1</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">        </span>!<span class="w"> </span>whiptail_enabled<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nv">$t</span><span class="w"> </span>skip<span class="w"> </span><span class="s2">&quot;No deps.&quot;</span>

<span class="w">        </span><span class="nb">local</span><span class="w"> </span>box
<span class="w">        </span><span class="nv">box</span><span class="o">=</span><span class="k">$(</span>WTInputBox<span class="w"> </span><span class="s2">&quot;Text&quot;</span><span class="k">)</span>
<span class="w">        </span>assert_ze<span class="w"> </span><span class="nv">$?</span>

<span class="w">        </span><span class="c1"># Mocking whiptail command.</span>
<span class="w">        </span><span class="k">function</span><span class="w"> </span>whiptail<span class="o">()</span><span class="w"> </span><span class="o">{</span>
<span class="w">                </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Result&quot;</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">3</span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="m">0</span>
<span class="w">        </span><span class="o">}</span>
<span class="w">        </span><span class="nb">local</span><span class="w"> </span>-r<span class="w"> </span><span class="nv">res</span><span class="o">=</span><span class="k">$(</span>WTResult<span class="k">)</span>
<span class="w">        </span><span class="nv">$box</span><span class="w"> </span>show<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$res</span><span class="s2">&quot;</span>
<span class="w">        </span>assert_eq<span class="w"> </span><span class="k">$(</span><span class="nv">$res</span><span class="w"> </span>val<span class="k">)</span><span class="w"> </span><span class="s2">&quot;Result&quot;</span>
<span class="o">}</span>
<span class="nb">readonly</span><span class="w"> </span>-f<span class="w"> </span>test_whiptail_input_box
</pre></div>
</div>
</section>
<section id="running-tests">
<h2>Running Tests<a class="headerlink" href="#running-tests" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">gobash</span> <span class="pre">test</span></code> command can be used for running tests.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./gobash<span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="c1"># arguments as you wish</span>
</pre></div>
</div>
<p>Below is the help message for <code class="docutils literal notranslate"><span class="pre">gobash</span> <span class="pre">test</span></code>, which is printed when
running the framework without any arguments.  (While we strive to keep
this doc up-to-date, the latest help message is best obtained by
running <code class="docutils literal notranslate"><span class="pre">gobash</span> <span class="pre">test</span></code>.)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Testing<span class="w"> </span>package.
<span class="w">  </span>--paths<span class="w"> </span><span class="o">(</span>string<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Name<span class="w"> </span>pattern<span class="w"> </span><span class="k">for</span><span class="w"> </span>finding<span class="w"> </span>files<span class="w"> </span>with<span class="w"> </span>tests.
<span class="w">  </span>--tests<span class="w"> </span><span class="o">(</span>string<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Regular<span class="w"> </span>expression<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span>functions<span class="w"> </span>to<span class="w"> </span>run.
<span class="w">  </span>--verbose<span class="w"> </span><span class="o">(</span>bool<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Enables<span class="w"> </span>verbose<span class="w"> </span>output.
<span class="w">  </span>--quiet<span class="w"> </span><span class="o">(</span>bool<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Disable<span class="w"> </span>any<span class="w"> </span>output.
<span class="w">  </span>--junitxml<span class="w"> </span><span class="o">(</span>string<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>File<span class="w"> </span>name<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>report<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>JUnit<span class="w"> </span>xml<span class="w"> </span>format.
<span class="w">  </span>--max_secs<span class="w"> </span><span class="o">(</span>int<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Max<span class="w"> </span>seconds<span class="w"> </span>per<span class="w"> </span>test.
<span class="w">  </span>--stdout<span class="w"> </span><span class="o">(</span>bool<span class="o">)</span><span class="w"> </span>-<span class="w"> </span>Enable<span class="w"> </span>stdout<span class="w"> </span>from<span class="w"> </span>tests.
</pre></div>
</div>
<p>Run all tests available in files in the current directory and any sub
directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gobash<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--paths<span class="w"> </span>.
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Given value to the <code class="docutils literal notranslate"><span class="pre">paths</span></code> flag is used as a name pattern of a
<code class="docutils literal notranslate"><span class="pre">find</span></code> command to find files with tests.</p>
</div>
<p>Run all available in the given file (the file does not need to be in
the current working directory.):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gobash<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--paths<span class="w"> </span>src/util/strings_test.sh
<span class="w">  </span>./src/util/strings_test.sh<span class="w"> </span><span class="m">8</span><span class="o">[</span>sec<span class="o">]</span>
Tests<span class="w"> </span>run:<span class="w"> </span><span class="m">23</span>,<span class="w"> </span>failed:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>skipped:<span class="w"> </span><span class="m">0</span>.
Total<span class="w"> </span>time:<span class="w"> </span><span class="m">8</span><span class="o">[</span>sec<span class="o">]</span>
</pre></div>
</div>
<p>Run selected tests available in the given file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>gobash<span class="w"> </span><span class="nb">test</span><span class="w"> </span>--paths<span class="w"> </span>strings_test.sh<span class="w"> </span>--tests<span class="w"> </span>test_strings_len
./src/util/strings_test.sh<span class="w"> </span><span class="m">783</span><span class="o">[</span>ms<span class="o">]</span>
Tests<span class="w"> </span>run:<span class="w"> </span><span class="m">1</span>,<span class="w"> </span>failed:<span class="w"> </span><span class="m">0</span>,<span class="w"> </span>skipped:<span class="w"> </span><span class="m">0</span>.
Total<span class="w"> </span>time:<span class="w"> </span><span class="m">852</span><span class="o">[</span>ms<span class="o">]</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Given value to the <code class="docutils literal notranslate"><span class="pre">tests</span></code> flag is used as a value for a <code class="docutils literal notranslate"><span class="pre">grep</span></code>
command to filter tests of interest to run.</p>
</div>
<div class="toctree-wrapper compound">
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">gobash</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="get-started.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="language.html">Language Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="process-communication.html">Inter-process Communication</a></li>
<li class="toctree-l1"><a class="reference internal" href="interactive-mode.html">Interactive Mode</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing Package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writing-tests">Writing Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-outcome">Test Outcome</a></li>
<li class="toctree-l2"><a class="reference internal" href="#accessing-test-metadata">Accessing Test Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="#skipping-tests">Skipping Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#asserting-results">Asserting Results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mocking-functions">Mocking Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running Tests</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command-line-flags.html">Command Line Flags</a></li>
<li class="toctree-l1"><a class="reference internal" href="next.html">Next</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="interactive-mode.html" title="previous chapter">Interactive Mode</a></li>
      <li>Next: <a href="command-line-flags.html" title="next chapter">Command Line Flags</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Milos Gligoric.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/testing.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>